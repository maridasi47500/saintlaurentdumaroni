function init_ibox(){0==$("#overlay").length&&($("body").append('<div class="overlay" id="overlay" style="display:none; visibility:hidden; z-index: 1000; width: '+oldOverlayWidth+"px; height: "+oldOverlayHeight+'px; background-image:url(/_images/icones/ibox_loading.png); background-repeat: no-repeat; background-position: center center"><span id="ibox_close_perso" class="close"></span><img id="ibox_close" class="close" src="'+img_ibox_close+'" style="display:none" /><div class="contentWrap"></div></div>'),$("body").append('<div id="overlay-opacity"></div>')),initOverlays(),$(window).resize(function(){centerLayer("overlay")})}function initOverlays(){op=$("#overlay-opacity").css("opacity"),$("#overlay-opacity").css("filter")&&(tmp=$("#overlay-opacity").css("filter").split(/Opacity=/i),tmp.length>1&&(op=parseInt(tmp[1])/100)),0==$('a[rel="#overlay"]').length&&$("body").append('<a rel="#overlay"></a>'),overlays=$('a[rel="#overlay"], a[rel*="ibox"]').overlay({mask:{color:"#000",loadSpeed:200,opacity:op},top:"center",closeOnClick:!1,closeOnEsc:!0,api:!0,target:"#overlay",onBeforeLoad:function(){if(wrap=this.getOverlay().find(".contentWrap"),wrap.html(""),this.getConf().closeOnEsc=overlayCloseOnEsc,!preventOverlay){var e=this.getTrigger().attr("href");e.match(/^javascript/)&&(e=this.getTrigger().attr("rel")),showOverlay(e)}},onClose:function(){$("#overlay").css("width",oldOverlayWidth),$("#overlay").css("height",oldOverlayHeight),prevIbox=nextIbox="",wrap=null}})}function initOverlayRel(e,t){e.preventDefault(),overlays.load(),wrap=$("#overlay").find(".contentWrap"),wrap.html("");var o=t.attr("href");showOverlay(o)}function closeOverlay(){$("#overlay .close").click()}function isTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function showOverlay(e,t){centerLayer("overlay"),t?t+="&":t="",e.match(/\?/)&&(tmp=e.split("?"),t+=tmp[1],e=tmp[0]),args=t,link=e,link.match(/^#/)&&(args=$('a[href="'+link+'"]').attr("rel")),wrapHref=link,wrapHrefArgs=args,auto_width=!1,tmp=args.split(/width=/),tmp.length>1?$("#overlay").css("width",parseInt(tmp[1])+"px"):auto_width=!0,auto_height=!1,tmp=args.split(/height=/),tmp.length>1?$("#overlay").css("height",parseInt(tmp[1])+"px"):auto_height=!0,overlayCloseOnClick=link.match(/autoclose=1/)||args&&args.match(/autoclose=1/),noclose=args.match(/noclose=1/),noclose&&(overlayCloseOnClick=!1),$("#overlay").addClass("noloading"),args=$.unparam(args);var o=/\.jpg|\.jpeg|\.png|\.gif|\.html|\.htm|\.php|\.cfm|\.asp|\.aspx|\.jsp|\.jst|\.rb|\.rhtml|\.txt/g,r=link.match(o);if(".jpg"==r||".jpeg"==r||".png"==r||".gif"==r){if(overlayCloseOnClick=!0,imgPreloader=new Image,$(window).width()<800&&isTouchDevice())return window.open(link+"?"+args,"_blank"),!1;imgPreloader.onload=function(){t&&(tmp=t.split(/v=/),tmp.length>1&&(link+="?v="+parseInt(tmp[1]))),winW=$(window).width()-30,winH=$(window).height()-30,this.width>winW?(w=winW,this.height=parseInt(winW*this.height/this.width)):w=this.width,this.height>winH?(h=winH,w=parseInt(winH*w/this.height)):h=this.height,wrap.html('<img src="'+link+'" alt="" width="'+w+'" height="'+h+'" onclick="hideIbox()" />'),auto_height&&$("#overlay").css("height","auto"),centerLayer("overlay",auto_width),currentIndex=nbRel=0,currentRel=e+(t&&""!=t?"?"+t:""),$('a[rel*="ibox"]').each(function(e){nbRel++,$(this).attr("rel")==currentRel&&(currentIndex=e)}),nbRel>1&&(prevIbox="showIbox('"+$('a[rel*="ibox"]:eq('+(currentIndex>0?currentIndex-1:nbRel-1)+")").attr("rel")+"')",nextIbox="showIbox('"+$('a[rel*="ibox"]:eq('+(currentIndex<nbRel-1?currentIndex+1:0)+")").attr("rel")+"')")},imgPreloader.src=link,$("#overlay").removeClass("noloading")}else link.match(/^#/)?(wrap.html($(link).html()),auto_height&&$("#overlay").css("height","auto"),centerLayer("overlay",auto_width)):$.browser.msie?$.post(link,args,function(e){wrap.html(e),auto_height&&$("#overlay").css("height","auto"),centerLayer("overlay",auto_width),$("#ibox_picture").length&&($("#ibox_picture")[0].onload=function(){centerLayer("overlay",auto_width)})}):wrap.load(link,args,function(){auto_height&&$("#overlay").css("height","auto"),centerLayer("overlay",auto_width),$("#ibox_picture").length&&($("#ibox_picture")[0].onload=function(){centerLayer("overlay",auto_width)})});overlays.getConf().closeOnClick=overlayCloseOnClick,overlayCloseOnClick?($("#overlay .close").hide(),$("#overlay").mouseover(function(){$("#overlay .close").show()}),$("#overlay").mouseout(function(){$("#overlay .close").hide()})):noclose||$("#overlay .close").show(),$("#overlay").css("visibility","visible")}function centerLayer(e,t){t&&$("#"+e).css("width","auto"),newTop=parseInt(($(window).height()-$("#"+e).height())/2),$("#"+e).css("top",newTop+"px"),newLeft=parseInt(($(window).width()-$("#"+e).width())/2),$("#"+e).css("left",newLeft+"px"),$(".contentWrap").css("visibility","visible")}function refreshOverlay(){wrapHref&&showOverlay(wrapHref)}function getHrefOverlay(){return new Array(wrapHref,wrapHrefArgs)}function showIbox(e,t,o,r){preventOverlay=!0,e.match(/^#/)&&(args=$('a[href="'+e+'"]').attr("rel"),overlayCloseOnEsc=!args.match(/noclose=1/)),wrap||overlays.load(),preventOverlay=!1,showOverlay(e,(o?o:"")+(r?"&"+r:""))}function prev_next_ibox(e){return 37==e.keyCode&&""!=prevIbox?($(".contentWrap").css("visibility","hidden"),eval(prevIbox),!1):39==e.keyCode&&""!=nextIbox?($(".contentWrap").css("visibility","hidden"),eval(nextIbox),!1):void 0}function parseQuery(e){return e}function hideIbox(){closeOverlay()}function invisibleIbox(){$("#overlay").hide()}var wrap,wrapHref,wrapHrefArgs,overlays,oldOverlayWidth=400,oldOverlayHeight=250,overlayFromPopup=!1,overlayCloseOnClick=!1,overlayCloseOnEsc=!0,preventOverlay=!1,img_ibox_close="/_images/icones/ibox_close.png",prevIbox="",nextIbox="";$(function(){init_ibox(),$("body").keydown(function(e){return prev_next_ibox(e)})});